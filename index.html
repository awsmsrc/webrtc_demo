<html>
  <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>

      var mediaConstraints = {
        optional: [],
        mandatory: {
          OfferToReceiveAudio: true,
          OfferToReceiveVideo: true
        }
      };

      window.RTCPeerConnection = window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
      window.RTCSessionDescription = window.mozRTCSessionDescription || window.RTCSessionDescription;
      window.RTCIceCandidate = window.mozRTCIceCandidate || window.RTCIceCandidate;

      var getUserMedia = function(callback) {
        navigator.getUserMedia({
          audio: true,
          video: true
        }, callback, onerror);

        function onerror(e) {
          console.error(e);
        }
      }

      var onSdpError  = function(e) {
        console.error('onSdpError', e);
      }

      vat onSdpSucces = function() {
        console.log('onSdpSucces');
      }

      $(function(){
        var socket = io.connect('http://localhost');

        var caller = function(){
          return $('#caller').val()
        }

        var callee = function(){
          return $('#callee').val()
        }

        var me = function(){
          return caller()
        }

        socket.on('connected', function(data){
          console.log('connected :)')
        })

        socket.on('incoming', function(data){
          if(data.name == me()){
            console.log('receiving call from ' + data.name)
          }
        })


        $('#call').click(function(){
          socket.emit('outgoing', { name: callee(), ice:1 });
        })
      })

    </script>
  </head>
  <body>
    <form>
      <label for="name">Your name</label>
      <input type="text" name="name" id="caller"/>
    </form>
    <video id="vid" autoplay controls style="width:40%;"></video>
    <form>
      <label for="call">Contact</label>
      <input type="text" id="callee"/>
      <input type="button" value="call" id="call"/>
    </form>
  </body>
</html>
